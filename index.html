<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GTA RP Food Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- jsPDF for generating PDF receipt -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      /* Background image */
      background:
        linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.8)),
        url("../Images/background.jpg") center center fixed no-repeat;
      background-size: cover;

      color: #f5f5f5;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 20px;
    }

    .app {
      width: 100%;
      max-width: 1100px;
      background: rgba(7, 10, 15, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
      padding: 24px;
      display: grid;
      grid-template-columns: 2fr 1.2fr;
      gap: 20px;
    }

    /* Left side: intro + menu */
    .left {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .shop-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }

    .shop-brand {
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }

    .shop-logo {
      width: 64px;
      height: 64px;
      object-fit: contain;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.18);
      flex-shrink: 0;
    }

    .shop-title {
      font-size: 1.8rem;
      font-weight: 700;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    .status-pill {
      font-size: 0.75rem;
      padding: 5px 10px;
      border-radius: 999px;
      background: rgba(46, 204, 113, 0.15);
      color: #2ecc71;
      border: 1px solid rgba(46, 204, 113, 0.35);
    }

    .shop-tagline {
      font-size: 0.9rem;
      opacity: 0.85;
      margin-top: 4px;
    }

    .shop-intro {
      font-size: 0.85rem;
      opacity: 0.8;
      line-height: 1.5;
      margin-top: 6px;
    }

    .badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    .badge {
      font-size: 0.7rem;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      opacity: 0.9;
    }

    .section-title {
      font-weight: 600;
      margin-top: 10px;
      margin-bottom: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-size: 0.8rem;
      opacity: 0.9;
    }

    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(190px, 1fr));
      gap: 12px;
    }

    .menu-item {
      background: rgba(11, 16, 24, 0.9);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      padding: 10px 12px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      position: relative;
      overflow: hidden;
    }

    .menu-item::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top right, rgba(255, 255, 255, 0.06), transparent 55%);
      opacity: 0.7;
      pointer-events: none;
    }

    .menu-image {
      width: 100%;
      border-radius: 10px;
      object-fit: cover;
      aspect-ratio: 4 / 3;
      margin-bottom: 6px;
    }

    .menu-name {
      font-size: 0.9rem;
      font-weight: 600;
    }

    .menu-meta {
      font-size: 0.7rem;
      opacity: 0.7;
    }

    .menu-bottom {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 4px;
    }

    .price {
      font-weight: 600;
      font-size: 0.9rem;
    }

    .btn {
      border: none;
      outline: none;
      cursor: pointer;
      border-radius: 999px;
      font-size: 0.75rem;
      padding: 6px 10px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .btn-add {
      background: linear-gradient(135deg, #e67e22, #f1c40f);
      color: #1b1b1b;
      box-shadow: 0 0 12px rgba(243, 156, 18, 0.45);
    }

    .btn-add:active {
      transform: scale(0.97);
    }

    /* Right side: cart */
    .cart {
      background: rgba(7, 10, 15, 0.95);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .cart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 6px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }

    .cart-title {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .cart-badge {
      font-size: 0.7rem;
      background: rgba(255, 255, 255, 0.05);
      padding: 4px 8px;
      border-radius: 999px;
      opacity: 0.9;
    }

    .cart-items {
      max-height: 280px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .cart-empty {
      font-size: 0.8rem;
      opacity: 0.7;
      margin-top: 18px;
      text-align: center;
    }

    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
      font-size: 0.8rem;
    }

    .cart-item-left {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .cart-item-name {
      font-weight: 500;
    }

    .cart-item-meta {
      font-size: 0.7rem;
      opacity: 0.7;
    }

    .cart-item-right {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .cart-summary {
      margin-top: 6px;
      padding-top: 6px;
      border-top: 1px dashed rgba(255, 255, 255, 0.2);
      font-size: 0.85rem;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      margin: 2px 0;
    }

    .summary-row.total {
      font-weight: 700;
      margin-top: 4px;
    }

    .checkout {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .btn-checkout {
      width: 100%;
      justify-content: center;
      background: linear-gradient(135deg, #27ae60, #2ecc71);
      color: #f5f5f5;
      box-shadow: 0 0 14px rgba(39, 174, 96, 0.4);
      padding: 8px 10px;
    }

    .checkout-note {
      font-size: 0.75rem;
      opacity: 0.7;
      text-align: center;
    }

    .qty-input {
      width: 60px;
      padding: 3px;
      background: rgba(0, 0, 0, 0.4);
      color: #fff;
      border: 1px solid rgba(255, 255, 255, 0.25);
      border-radius: 6px;
      text-align: center;
      font-size: 0.8rem;
    }

    .qty-input::-webkit-inner-spin-button,
    .qty-input::-webkit-outer-spin-button {
      opacity: 1;
    }

    .qty-apply {
      font-size: 0.7rem;
      padding: 4px 8px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.35);
      background: rgba(255, 255, 255, 0.06);
      color: #f5f5f5;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .qty-apply:active {
      transform: scale(0.96);
    }

    .checkout-inputs {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 10px;
    }

    .checkout-inputs label {
      font-size: 0.8rem;
      opacity: 0.8;
    }

    .checkout-field {
      padding: 8px;
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.18);
      color: #fff;
      font-size: 0.85rem;
    }

    .checkout-field::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }

    /* ---------- Responsive ---------- */

    @media (max-width: 900px) {
      body {
        padding: 12px;
      }

      .app {
        grid-template-columns: 1fr;
        padding: 18px;
        gap: 16px;
      }

      .cart {
        order: 2;
      }

      .left {
        order: 1;
      }
    }

    @media (max-width: 768px) {
      .shop-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .shop-brand {
        align-items: center;
      }

      .shop-logo {
        width: 52px;
        height: 52px;
      }

      .shop-title {
        font-size: 1.4rem;
      }

      .shop-tagline,
      .shop-intro {
        font-size: 0.8rem;
      }

      .status-pill {
        align-self: flex-start;
        margin-top: 4px;
      }

      .menu-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 480px) {
      body {
        padding: 10px;
      }

      .app {
        padding: 14px;
      }

      .menu-grid {
        grid-template-columns: 1fr;
      }

      .cart-summary {
        font-size: 0.8rem;
      }

      .cart-title {
        font-size: 0.8rem;
      }

      .cart-badge {
        font-size: 0.65rem;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- LEFT: INTRO + MENU -->
    <div class="left">
      <header class="shop-header">
        <div class="shop-brand">
          <!-- BUSINESS LOGO -->
          <img src="../Images/logo.png" alt="Foodie Haven Logo" class="shop-logo">
          <div>
            <div class="shop-title">Foodie Haven</div>
            <div class="shop-tagline">Adyar, Near Boat Garage, 8245</div>
            <p class="shop-intro">
              Welcome to <strong>Foodie Haven</strong>, premium burgers & drinks.
              Order directly through this portal and our staff will deliver to your location.
            </p>
            <div class="badge-row">
              <span class="badge">‚è± Open: 24/7 RP</span>
              <span class="badge">üöó Free city-wide delivery</span>
              <span class="badge">üíµ Cash / Bank / UPI (RP)</span>
            </div>
          </div>
        </div>
        <span class="status-pill">Online ‚Ä¢ Taking Orders</span>
      </header>

      <div>
        <div class="section-title">
          <span>Menu</span>
          <span style="font-size: 0.7rem; opacity: 0.6;">Select items to add to your cart</span>
        </div>

        <div class="menu-grid" id="menu">
          <!-- Menu items will be rendered here by JS -->
        </div>
      </div>
    </div>

    <!-- RIGHT: CART -->
    <aside class="cart">
      <div class="cart-header">
        <div class="cart-title">Your Cart</div>
        <div class="cart-badge"><span id="cart-items-count">0</span> items</div>
      </div>

      <div class="cart-items" id="cart-items">
        <div class="cart-empty">No items yet. Add something from the menu.</div>
      </div>

      <div class="cart-summary">
        <div class="summary-row">
          <span>Subtotal</span>
          <span>‚Çπ<span id="subtotal">0</span></span>
        </div>
        <div class="summary-row">
          <span>Discount (<span id="discount-percent">0</span>%)</span>
          <span>- ‚Çπ<span id="discount-amount">0</span></span>
        </div>
        <div class="summary-row">
          <span>Delivery (fee)</span>
          <span>‚Çπ<span id="delivery">0</span></span>
        </div>
        <div class="summary-row total">
          <span>Total</span>
          <span>‚Çπ<span id="total">0</span></span>
        </div>
      </div>

      <div class="checkout">
        <div class="checkout-inputs">
          <label for="char-name">Character Name</label>
          <input
            type="text"
            id="char-name"
            class="checkout-field"
            placeholder="Ex: Jhon"
          >

          <label for="char-phone">IC Phone Number</label>
          <input
            type="number"
            id="char-phone"
            class="checkout-field"
            placeholder="Ex: 123456"
          >
		  
		  <label for="order-for">Ordering For</label>
		  <input
			type="text"
			id="order-for"
			class="checkout-field"
			placeholder="Ex: For MCPD / For EMS / For Mechanic"
		  >
        </div>

        <button class="btn btn-checkout" id="checkout-btn">Place Order</button>
        <div class="checkout-note">
          After placing order, the receipt will be sent to Discord. You can also download it as PDF.
        </div>
      </div>
    </aside>
  </div>

  <script>
    // shop / receipt config
    const SHOP_NAME = "Foodie Haven";
    const SHOP_ADDRESS = "Adyar, Near Boat Garage, 8245";
    const GST_RATE = 0; // in %

    const MENU_ITEMS = [
      { id: 1,  name: "HamBurger",            description: "Classic grilled burger.",              price: 1700, image: "../Images/HamBurger.png" },
      { id: 2,  name: "Cheese Burger",        description: "Juicy patty with melted cheese.",     price: 1700, image: "../Images/Cheese Burger.png" },
      { id: 3,  name: "Double Cheese Burger", description: "Two patties, double cheese blast.",   price: 2500, image: "../Images/Double Cheese Burger.png" },
      { id: 4,  name: "BBQ Bacon Burger",     description: "Smoky BBQ sauce & crispy bacon.",     price: 3200, image: "../Images/BBQ Bacon Burger.png" },
      { id: 5,  name: "Chicken Burger",       description: "Crispy chicken fillet burger.",       price: 2500, image: "../Images/Chicken Burger.png" },
      { id: 6,  name: "Fries",                description: "Golden salted fries.",                price: 750,  image: "../Images/Fries.png" },
      { id: 7,  name: "Spunk",                description: "Signature soft drink.",               price: 2500, image: "../Images/Spunk.png" },
      { id: 8,  name: "Spunk Lite",           description: "Low sugar, same kick.",               price: 1700, image: "../Images/Spunk Lite.png" },
      { id: 9,  name: "E-Cola",               description: "Carbonated energy cola.",             price: 2500, image: "../Images/E-Cola.png" },
      { id: 10, name: "E-Cola Lite",          description: "Zero sugar energy cola.",             price: 1700, image: "../Images/E-Cola Lite.png" }
    ];

    const DELIVERY_FEE = 0; // in ‚Çπ

    const menuContainer = document.getElementById("menu");
    const cartItemsContainer = document.getElementById("cart-items");
    const cartItemsCount = document.getElementById("cart-items-count");
    const subtotalEl = document.getElementById("subtotal");
    const discountPercentEl = document.getElementById("discount-percent");
    const discountAmountEl = document.getElementById("discount-amount");
    const deliveryEl = document.getElementById("delivery");
    const totalEl = document.getElementById("total");
    const checkoutBtn = document.getElementById("checkout-btn");

    let cart = [];
    let lastBillNo = null; // for PDF filename

    const padEnd = (value, length) => String(value).padEnd(length, " ");
    const padStart = (value, length) => String(value).padStart(length, " ");
    const formatAmount = (n) => Number(n).toLocaleString("en-IN");

    function generateBillNumber() {
      const now = new Date();
      const datePart = now.toLocaleDateString("en-GB").replace(/\//g, "");
      const randomPart = String(Math.floor(Math.random() * 900) + 100);
      return `${datePart}${randomPart}`;
    }

    function renderMenu() {
      menuContainer.innerHTML = "";
      MENU_ITEMS.forEach(item => {
        const div = document.createElement("div");
        div.className = "menu-item";
        div.innerHTML = `
          <img src="${item.image}" alt="${item.name}" class="menu-image" />
          <div class="menu-name">${item.name}</div>
          <div class="menu-meta">${item.description}</div>
          <div class="menu-bottom">
            <div class="price">‚Çπ${item.price}</div>
            <button class="btn btn-add" data-id="${item.id}">+ Add</button>
          </div>
        `;
        menuContainer.appendChild(div);
      });

      const addButtons = menuContainer.querySelectorAll(".btn-add");
      addButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          const id = parseInt(btn.getAttribute("data-id"), 10);
          addToCart(id);
        });
      });
    }

    function addToCart(id) {
      const item = MENU_ITEMS.find(m => m.id === id);
      if (!item) return;

      const existing = cart.find(c => c.id === id);
      if (existing) {
        existing.qty += 1;
      } else {
        cart.push({ id: item.id, name: item.name, price: item.price, qty: 1 });
      }
      renderCart();
    }

    // Discount logic: ‚â•1L 1%, ‚â•2L 2%, ... ‚â•5L 5%, ‚â•10L 10%
    function getDiscountPercent(subtotal) {
      if (subtotal >= 1000000) return 10;
      if (subtotal >= 500000) return 5;
      if (subtotal >= 400000) return 4;
      if (subtotal >= 300000) return 3;
      if (subtotal >= 200000) return 2;
      if (subtotal >= 100000) return 1;
      return 0;
    }

    function changeQtyDirect(id, newQty) {
      const item = cart.find(c => c.id === id);
      if (!item) return;

      if (newQty <= 0 || isNaN(newQty)) {
        const idx = cart.findIndex(c => c.id === id);
        if (idx !== -1) cart.splice(idx, 1);
      } else {
        item.qty = newQty;
      }

      renderCart();
    }

    function renderCart() {
      cartItemsContainer.innerHTML = "";

      if (cart.length === 0) {
        cartItemsContainer.innerHTML =
          `<div class="cart-empty">No items yet. Add something from the menu.</div>`;
      } else {
        cart.forEach(item => {
          const row = document.createElement("div");
          row.className = "cart-item";
          row.innerHTML = `
            <div class="cart-item-left">
              <div class="cart-item-name">${item.name}</div>
              <div class="cart-item-meta">${item.qty} x ‚Çπ${item.price}</div>
            </div>
            <div class="cart-item-right">
              <input
                type="number"
                class="qty-input"
                data-id="${item.id}"
                min="1"
                value="${item.qty}"
              >
              <button class="qty-apply" data-id="${item.id}">OK</button>
            </div>
          `;
          cartItemsContainer.appendChild(row);
        });

        const qtyInputs = cartItemsContainer.querySelectorAll(".qty-input");
        const applyButtons = cartItemsContainer.querySelectorAll(".qty-apply");

        applyButtons.forEach(btn => {
          btn.addEventListener("click", () => {
            const id = parseInt(btn.getAttribute("data-id"), 10);
            const input = cartItemsContainer.querySelector(`.qty-input[data-id="${id}"]`);
            let qty = parseInt(input.value, 10);
            if (isNaN(qty) || qty <= 0) qty = 1;
            changeQtyDirect(id, qty);
          });
        });

        qtyInputs.forEach(input => {
          input.addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
              const id = parseInt(input.getAttribute("data-id"), 10);
              let qty = parseInt(input.value, 10);
              if (isNaN(qty) || qty <= 0) qty = 1;
              changeQtyDirect(id, qty);
            }
          });
        });
      }

      const itemsCount = cart.reduce((sum, item) => sum + item.qty, 0);
      const subtotal = cart.reduce((sum, item) => sum + item.qty * item.price, 0);
      const discountPercent = getDiscountPercent(subtotal);
      const discountAmount = Math.floor((subtotal * discountPercent) / 100);
      const delivery = cart.length > 0 ? DELIVERY_FEE : 0;
      const total = subtotal - discountAmount + delivery;

      cartItemsCount.textContent = itemsCount;
      subtotalEl.textContent = subtotal;
      discountPercentEl.textContent = discountPercent;
      discountAmountEl.textContent = discountAmount;
      deliveryEl.textContent = delivery;
      totalEl.textContent = total;
    }

    function buildReceiptText({ name, phone }) {
      const now = new Date();
      const dateStr = now.toLocaleDateString("en-GB");
      const billNo = generateBillNumber();
      lastBillNo = billNo; // remember for PDF filename

      const subtotal = Number(subtotalEl.textContent) || 0;
      const discountPercent = Number(discountPercentEl.textContent) || 0;
      const discountAmount = Number(discountAmountEl.textContent) || 0;
      const delivery = Number(deliveryEl.textContent) || 0;

      const subTotalAfterDiscount = subtotal - discountAmount;
      const gstAmount = Math.floor((subTotalAfterDiscount * GST_RATE) / 100);
      const grandTotal = subTotalAfterDiscount + gstAmount + delivery;

      const COL_SN = 3;
      const COL_NAME = 20;
      const COL_RATE = 10;
      const COL_QTY = 5;
      const COL_AMT = 12;

      const header =
        padEnd("S.No", COL_SN) + " | " +
        padEnd("Product Name", COL_NAME) + " | " +
        padEnd("Rate", COL_RATE) + " | " +
        padEnd("Qty", COL_QTY) + " | " +
        padEnd("Amount", COL_AMT);

      const lineWidth = header.length;
      const sepLine = "-".repeat(lineWidth);

      const lines = [];

      lines.push(padStart(SHOP_NAME, Math.floor((lineWidth + SHOP_NAME.length) / 2)));
      lines.push(padStart(SHOP_ADDRESS, Math.floor((lineWidth + SHOP_ADDRESS.length) / 2)));
      lines.push("");
      lines.push(padStart("TAX BILL", Math.floor((lineWidth + "TAX BILL".length) / 2)));
      lines.push("");
      lines.push(`Bill No : ${billNo}    Date: ${dateStr}`);
      lines.push(`M/s : ${name}`);
      lines.push(`IC Phone : ${phone}`);
	  lines.push(`Ordering For : ${orderFor}`);
      lines.push("");
      lines.push(header);
      lines.push(sepLine);

      const selectedItems = cart.filter(item => item.qty > 0);

      selectedItems.forEach((item, index) => {
        const amount = item.qty * item.price;

        const sn = padStart(index + 1, COL_SN);
        const pname = padEnd(item.name, COL_NAME);
        const rate = padStart("‚Çπ" + formatAmount(item.price), COL_RATE);
        const qstr = padStart(item.qty, COL_QTY);
        const astr = padStart("‚Çπ" + formatAmount(amount), COL_AMT);

        const row =
          sn + " | " +
          pname + " | " +
          rate + " | " +
          qstr + " | " +
          astr;

        lines.push(row);
      });

      if (selectedItems.length === 0) {
        lines.push("(no items)");
      }

      lines.push(sepLine);
      lines.push(padStart("Total : ‚Çπ" + formatAmount(subtotal), lineWidth));
      lines.push(
        padStart(
          `Discount @ ${discountPercent}% : ‚Çπ${formatAmount(discountAmount)}`,
          lineWidth
        )
      );
      lines.push(
        padStart("Sub Total : ‚Çπ" + formatAmount(subTotalAfterDiscount), lineWidth)
      );
      lines.push(
        padStart(`GST @ ${GST_RATE}% : ‚Çπ${formatAmount(gstAmount)}`, lineWidth)
      );
      if (DELIVERY_FEE > 0) {
        lines.push(
          padStart("Delivery : ‚Çπ" + formatAmount(delivery), lineWidth)
        );
      }
      lines.push(
        padStart("Grand Total : ‚Çπ" + formatAmount(grandTotal), lineWidth)
      );
      lines.push("");
      lines.push(padStart("For " + SHOP_NAME, lineWidth));
      lines.push("");
      lines.push(padStart("Authorized Signature", lineWidth));

      return lines.join("\n");
    }

    function downloadReceiptPdf(receiptText) {
	  if (!window.jspdf || !window.jspdf.jsPDF) {
		alert("PDF generator not available. Please try again.");
		return;
	  }

	  const { jsPDF } = window.jspdf;
	  const doc = new jsPDF({
		unit: "pt",
		format: "a4"
	  });

	  // Use a readable monospaced font & slightly bigger size
	  doc.setFont("courier", "normal");
	  doc.setFontSize(12);

	  const marginLeft = 40;
	  const marginTop = 40;
	  const lineHeight = 16;
	  const pageHeight = doc.internal.pageSize.getHeight();

	  let y = marginTop;

	  // üîπ Replace ‚Çπ with ASCII-safe "Rs." for PDF only
	  const pdfText = receiptText.replace(/‚Çπ/g, "Rs.");

	  pdfText.split("\n").forEach(line => {
		if (y > pageHeight - marginTop) {
		  doc.addPage();
		  y = marginTop;
		}
		doc.text(line, marginLeft, y);
		y += lineHeight;
	  });

	  const fileBillNo = lastBillNo || new Date().getTime();
	  doc.save(`FoodieHaven_Receipt_${fileBillNo}.pdf`);
	}

    checkoutBtn.addEventListener("click", async () => {
      if (cart.length === 0) {
        alert("Your cart is empty. Add something first.");
        return;
      }

	const name = document.getElementById("char-name").value.trim();
	const phone = document.getElementById("char-phone").value.trim();
	const orderFor = document.getElementById("order-for").value.trim();

	if (name === "" || phone === "" || orderFor === "") {
	  alert("Please fill Character Name, IC Phone Number, and Ordering For.");
	  return;
	}

      const receiptText = buildReceiptText({ name, phone });

	  const content =
		`üì¶ **New ${SHOP_NAME} Order**\n` +
		`üë§ **Character:** ${name}\n` +
		`üì± **IC Phone:** ${phone}\n` +
		`üè¢ **Ordering For:** ${orderFor}\n\n` +
		"```" + "\n" + receiptText + "\n```";

      try {
        checkoutBtn.disabled = true;
        checkoutBtn.textContent = "Sending...";

        // Call Netlify Function (which hides the webhook)
        const response = await fetch("/.netlify/functions/send-order", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ content }),
        });

        if (!response.ok) {
          console.error("Function response:", await response.text());
          alert("Failed to send order to Discord. Please try again later or place the order manually.");
        } else {
          const wantsPdf = confirm(
            "Order sent successfully!\n\nDo you want to download the receipt as a PDF?"
          );

          if (wantsPdf) {
            downloadReceiptPdf(receiptText);
          }

          cart = [];
          renderCart();
        }
      } catch (err) {
        console.error(err);
        alert("Error sending order!");
      } finally {
        checkoutBtn.disabled = false;
        checkoutBtn.textContent = "Place Order";
      }
    });

    // initial render
    renderMenu();
    renderCart();
  </script>
</body>
</html>
