<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Foodie Haven - Food Order Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- jsPDF (PDF generator) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; font-family:system-ui, sans-serif; }

    body {
      background: linear-gradient(rgba(0,0,0,0.6),rgba(0,0,0,0.8)),
                  url("Images/background.jpg") center/cover fixed;
      min-height:100vh;
      display:flex;
      justify-content:center;
      padding:20px;
      color:#fff;
    }

    .app {
      width:100%;
      max-width:1100px;
      background:rgba(10,10,15,0.9);
      backdrop-filter:blur(8px);
      padding:24px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,0.1);
      box-shadow:0 20px 40px rgba(0,0,0,0.6);
      display:grid;
      grid-template-columns:2fr 1.2fr;
      gap:20px;
    }

    /* LEFT SIDE */
    .shop-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding-bottom:12px;
      border-bottom:1px solid rgba(255,255,255,0.1);
    }

    .shop-brand { display:flex; gap:10px; }
    .shop-logo { width:64px; height:64px; border-radius:12px; }

    .shop-title { font-size:1.7rem; font-weight:700; }
    .shop-intro { font-size:0.85rem; opacity:0.8; margin-top:6px; }

    .badge-row { display:flex; gap:6px; margin-top:10px; flex-wrap:wrap; }
    .badge { border:1px solid rgba(255,255,255,0.15); padding:4px 8px; border-radius:999px; font-size:0.7rem;}

    .menu-grid { margin-top:12px; display:grid; grid-template-columns:repeat(auto-fill, minmax(180px,1fr)); gap:12px; }
    .menu-item {
      background:rgba(255,255,255,0.04);
      padding:12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.1);
    }

    .menu-image { width:100%; border-radius:10px; object-fit:cover; aspect-ratio:4/3; }
    .price { font-weight:600; }

    .btn { cursor:pointer; border:none; }
    .btn-add {
      background:linear-gradient(135deg,#e67e22,#f1c40f);
      padding:6px 12px;
      border-radius:999px;
      font-size:0.8rem;
      margin-left:auto;
      display:block;
    }

    /* RIGHT: CART */
    .cart {
      border:1px solid rgba(255,255,255,0.1);
      background:rgba(0,0,0,0.5);
      padding:16px;
      border-radius:16px;
    }

    .cart-item { display:flex; justify-content:space-between; border-bottom:1px solid rgba(255,255,255,0.1); padding:8px 0; }
    .qty-input { width:50px; text-align:center; border-radius:6px; padding:4px; }
    .qty-apply { padding:4px 8px; border-radius:8px; border:1px solid #777; font-size:0.7rem; }

    /* Checkout Inputs */
    .checkout-inputs { margin-top:12px; display:flex; flex-direction:column; gap:10px; }
    .checkout-field { padding:8px; border-radius:6px; border:1px solid rgba(255,255,255,0.2); background:rgba(255,255,255,0.1); color:#fff;}

    .btn-checkout {
      margin-top:12px;
      background:#27ae60;
      width:100%;
      padding:10px;
      border-radius:999px;
      font-weight:600;
      font-size:0.9rem;
      box-shadow:0 0 15px rgba(0,255,0,0.2);
    }

    @media(max-width:900px){
      .app { grid-template-columns:1fr; }
    }
  </style>
</head>
<body>

<div class="app">

  <!-- LEFT -->
  <div>
    <div class="shop-header">
      <div class="shop-brand">
        <img src="Images/logo.png" class="shop-logo">
        <div>
          <div class="shop-title">Foodie Haven</div>
          <div class="shop-intro">
            Adyar, Near Boat Garage, 8245<br>
            Premium burgers delivered in RP city.
          </div>
          <div class="badge-row">
            <span class="badge">24/7</span>
            <span class="badge">RP Delivery</span>
            <span class="badge">Cash / Bank / UPI</span>
          </div>
        </div>
      </div>
    </div>

    <h3 style="margin-top:12px;">Menu</h3>
    <div id="menu" class="menu-grid"></div>
  </div>

  <!-- RIGHT -->
  <div class="cart">
    <h3>Your Cart (<span id="cart-items-count">0</span>)</h3>

    <div id="cart-items" style="margin-top:10px;">
      <div style="opacity:0.6;">No items added.</div>
    </div>

    <div style="margin-top:15px;">
      <div>Subtotal: ‚Çπ<span id="subtotal">0</span></div>
      <div>Discount: <span id="discount-percent">0</span>% (‚Çπ<span id="discount-amount">0</span>)</div>
      <div>Total: ‚Çπ<span id="total">0</span></div>
    </div>

    <!-- Checkout fields -->
    <div class="checkout-inputs">
      <input id="char-name" class="checkout-field" placeholder="Character Name">
      <input id="char-phone" class="checkout-field" type="number" placeholder="IC Phone Number">
      <input id="order-for" class="checkout-field" placeholder="Ordering For (Ex: For MCPD)">
    </div>

    <button class="btn-checkout" id="checkout-btn">Place Order</button>
  </div>
</div>

<script>
/* ---------------- MENU DATA ---------------- */
const MENU_ITEMS = [
  {id:1, name:"HamBurger", price:1700, image:"Images/HamBurger.png"},
  {id:2, name:"Cheese Burger", price:1700, image:"Images/Cheese Burger.png"},
  {id:3, name:"Double Cheese Burger", price:2500, image:"Images/Double Cheese Burger.png"},
  {id:4, name:"BBQ Bacon Burger", price:3200, image:"Images/BBQ Bacon Burger.png"},
  {id:5, name:"Chicken Burger", price:2500, image:"Images/Chicken Burger.png"},
  {id:6, name:"Fries", price:750, image:"Images/Fries.png"},
  {id:7, name:"Spunk", price:2500, image:"Images/Spunk.png"},
  {id:8, name:"Spunk Lite", price:1700, image:"Images/Spunk Lite.png"},
  {id:9, name:"E-Cola", price:2500, image:"Images/E-Cola.png"},
  {id:10, name:"E-Cola Lite", price:1700, image:"Images/E-Cola Lite.png"}
];

let cart = [];
let lastBillNo = null;

/* ---------------- RENDER MENU ---------------- */
function renderMenu(){
  const m = document.getElementById("menu");
  m.innerHTML = "";
  MENU_ITEMS.forEach(i=>{
    m.innerHTML += `
      <div class="menu-item">
        <img src="${i.image}" class="menu-image">
        <div>${i.name}</div>
        <div class="price">‚Çπ${i.price}</div>
        <button class="btn btn-add" onclick="addToCart(${i.id})">+ Add</button>
      </div>`;
  });
}

/* ---------------- CART LOGIC ---------------- */
function addToCart(id){
  const item = MENU_ITEMS.find(x=>x.id===id);
  let c = cart.find(x=>x.id===id);
  if(c) c.qty++;
  else cart.push({...item, qty:1});
  renderCart();
}

function changeQty(id, qty){
  qty = Number(qty);
  if(qty<=0) cart = cart.filter(x=>x.id!==id);
  else cart.find(x=>x.id===id).qty = qty;
  renderCart();
}

function getDiscount(sub){
  if(sub>=1000000) return 10;
  if(sub>=500000) return 5;
  if(sub>=400000) return 4;
  if(sub>=300000) return 3;
  if(sub>=200000) return 2;
  if(sub>=100000) return 1;
  return 0;
}

function renderCart(){
  const c = document.getElementById("cart-items");
  c.innerHTML = "";

  if(cart.length===0){
    c.innerHTML = `<div style="opacity:0.6;">No items added.</div>`;
  } else {
    cart.forEach(i=>{
      c.innerHTML += `
        <div class="cart-item">
          <div>${i.name}<br><span style="opacity:0.6;">‚Çπ${i.price}</span></div>
          <div>
            <input class="qty-input" value="${i.qty}" onchange="changeQty(${i.id}, this.value)">
          </div>
        </div>`;
    });
  }

  document.getElementById("cart-items-count").innerText =
    cart.reduce((a,b)=>a+b.qty,0);

  const subtotal = cart.reduce((a,b)=>a+b.qty*b.price,0);
  const discount = getDiscount(subtotal);
  const discountAmt = Math.floor(subtotal * discount / 100);

  document.getElementById("subtotal").innerText = subtotal;
  document.getElementById("discount-percent").innerText = discount;
  document.getElementById("discount-amount").innerText = discountAmt;
  document.getElementById("total").innerText = subtotal - discountAmt;
}

/* ---------------- RECEIPT BUILDER ---------------- */
function generateBillNo(){
  const d=new Date();
  const x=d.toLocaleDateString("en-GB").replace(/\//g,"");
  return x+String(Math.floor(Math.random()*900)+100);
}

function buildReceipt(name, phone, orderFor){
  const date = new Date().toLocaleDateString("en-GB");
  const billNo = generateBillNo();
  lastBillNo = billNo;

  let lines = [];
  lines.push("          FOODIE HAVEN");
  lines.push("   Adyar, Near Boat Garage, 8245");
  lines.push("");
  lines.push(`Bill No : ${billNo}     Date : ${date}`);
  lines.push(`Customer  : ${name}`);
  lines.push(`Phone     : ${phone}`);
  lines.push(`For       : ${orderFor}`);
  lines.push("---------------------------------------------");
  lines.push("S.No  Item                     Qty   Amount");
  lines.push("---------------------------------------------");

  cart.forEach((item, idx)=>{
    let amt = item.qty * item.price;
    lines.push(
      `${String(idx+1).padEnd(5)}${item.name.padEnd(24)}${String(item.qty).padEnd(6)}Rs.${amt}`
    );
  });

  const subtotal = Number(document.getElementById("subtotal").innerText);
  const dis = Number(document.getElementById("discount-amount").innerText);
  const total = Number(document.getElementById("total").innerText);

  lines.push("---------------------------------------------");
  lines.push(`Subtotal : Rs.${subtotal}`);
  lines.push(`Discount : Rs.${dis}`);
  lines.push(`Total    : Rs.${total}`);
  lines.push("---------------------------------------------");

  return lines.join("\n");
}

/* ---------------- PDF GENERATOR ---------------- */
function generatePDF(text){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({unit:"pt", format:"a4"});
  doc.setFont("courier", "normal");
  doc.setFontSize(12);

  let y = 40;
  text.split("\n").forEach(line=>{
    doc.text(line, 40, y);
    y += 16;
  });

  doc.save(`FoodieHaven_Receipt_${lastBillNo}.pdf`);
}

/* ---------------- CHECKOUT HANDLER ---------------- */
document.getElementById("checkout-btn").onclick = async () => {
  if(cart.length===0) return alert("Add items first!");

  const name = document.getElementById("char-name").value.trim();
  const phone = document.getElementById("char-phone").value.trim();
  const orderFor = document.getElementById("order-for").value.trim();

  if(!name || !phone || !orderFor)
    return alert("Fill Character Name, Phone & Ordering For.");

  const receipt = buildReceipt(name, phone, orderFor);

  const content =
    `üì¶ **Foodie Haven Order**\n`+
    `üë§ Customer: ${name}\n`+
    `üì± Phone: ${phone}\n`+
    `üè¢ Ordering For: ${orderFor}\n\n`+
    "```\n"+receipt+"\n```";

  /* SEND TO NETLIFY FUNCTION */
  const res = await fetch("/.netlify/functions/send-order", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({content})
  });

  if(!res.ok){
    alert("Failed to send order to Discord.");
    return;
  }

  if(confirm("Order sent!\nDownload PDF receipt?"))
    generatePDF(receipt);

  cart=[];
  renderCart();
};

/* INITIAL LOAD */
renderMenu();
renderCart();
</script>

</body>
</html>

